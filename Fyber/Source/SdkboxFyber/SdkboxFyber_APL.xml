<?xml version="1.0" encoding="utf-8"?>
<root xmlns:android="http://schemas.android.com/apk/res/android">
  <init>
	   <log text="SDKBOX Fyber APL Init"/>

	   <setBoolFromProperty result="bDisableVideoPreCaching" ini="Engine" section="/Script/SdkboxFyber.SdkboxFyberSettings" property="DisableVideoPreCaching" default="false"/>
     <setIntFromProperty  result="iCloseButtonDelay" ini="Engine" section="/Script/SdkboxFyber.SdkboxFyberSettings" property="VideoCloseButtonDelayLength" default="0"/>

      <setStringFromProperty result="sFyberAppId"         ini="Engine" section="/Script/SdkboxFyber.SdkboxFyberSettings" property="AppID"         default=""/>
      <setStringFromProperty result="sFyberSecurityToken" ini="Engine" section="/Script/SdkboxFyber.SdkboxFyberSettings" property="SecurityToken" default=""/>
  </init>

  <androidManifestUpdates>

      <if condition="bDisableVideoPreCaching">
          <false>
              <setElement result="serviceAddition" value="service"/>
              <addAttribute tag="$serviceAddition" name="android:name" value="com.fyber.cache.CacheVideoDownloadService"/>
              <addAttribute tag="$serviceAddition" name="android:exported" value="false"/>
              <addElement tag="application" name="serviceAddition"/>
          </false>
      </if>

      <setElement result="RewardedVideoActivity" value="activity"/>
      <addAttribute  tag="$RewardedVideoActivity"  name="android:name"  value="com.fyber.ads.videos.RewardedVideoActivity"/>
      <addAttribute  tag="$RewardedVideoActivity"  name="android:configChanges" value="screenSize|orientation"/>
      <addAttribute  tag="$RewardedVideoActivity"  name="android:hardwareAccelerated" value="true"/>
      <addAttribute  tag="$RewardedVideoActivity"  name="android:theme" value="@android:style/Theme.Translucent"/>
      <addElement    tag="application"         name="RewardedVideoActivity"/>

	  <setElement result="OfferWallActivity" value="activity"/>
      <addAttribute  tag="$OfferWallActivity"  name="android:name"  value="com.fyber.ads.ofw.OfferWallActivity"/>
      <addAttribute  tag="$OfferWallActivity"  name="android:configChanges" value="screenSize|orientation"/>
      <addElement    tag="application"         name="OfferWallActivity"/>

      <setElement result="InterstitialActivity" value="activity"/>
      <addAttribute  tag="$InterstitialActivity"  name="android:name"  value="com.fyber.ads.interstitials.InterstitialActivity"/>
      <addAttribute  tag="$InterstitialActivity"  name="android:configChanges" value="screenSize|orientation"/>
      <addAttribute  tag="$InterstitialActivity"  name="android:theme" value="@android:style/Theme.Translucent"/>
      <addElement    tag="application"         name="InterstitialActivity"/>

      <setElement result="CacheVideoDownloadService" value="activity"/>
      <addAttribute  tag="$CacheVideoDownloadService"  name="android:name"  value="com.fyber.cache.CacheVideoDownloadService"/>
      <addAttribute  tag="$CacheVideoDownloadService"  name="android:exported" value="false"/>
      <addElement    tag="application"         name="CacheVideoDownloadService"/>

      <addPermission android:name="android.permission.INTERNET" />
      <addPermission android:name="android.permission.READ_PHONE_STATE" />
      <addPermission android:name="android.permission.ACCESS_NETWORK_STATE" />
      <addPermission android:name="android.permission.ACCESS_WIFI_STATE" />
      <addPermission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />

      <setElement result="UnityAdsActivity" value="activity"/>
      <addAttribute tag="$UnityAdsActivity"  name="android:name" value="com.unity3d.ads.android.view.UnityAdsFullscreenActivity"/>
      <addAttribute tag="$UnityAdsActivity"  name="android:configChanges" value="fontScale|keyboard|keyboardHidden|locale|mnc|mcc|navigation|orientation|screenLayout|screenSize|smallestScreenSize|uiMode|touchscreen"/>
      <addAttribute tag="$UnityAdsActivity"  name="android:theme" value="@android:style/Theme.NoTitleBar.Fullscreen"/>
      <addAttribute tag="$UnityAdsActivity"  name="android:hardwareAccelerated" value="true"/>
      <addElement    tag="application"       name="UnityAdsActivity"/>

      <setElement result="CloseButtonDelayMetaData" value="meta-data"/>
      <addAttribute tag="$CloseButtonDelayMetaData" name="android:name" value="FYBVideoPlayerOptionCloseButtonDelay"/>
      <addAttribute tag="$CloseButtonDelayMetaData" name="android:value" value="$I(iCloseButtonDelay)"/>
      <addElement tag="application" name="CloseButtonDelayMetaData"/>

  </androidManifestUpdates>

  <prebuildCopies>
      <copyFile src="$S(PluginDir)/../../lib/Android/libs/fyber-sdk-8.5.1.jar" dst="$S(BuildDir)/libs/fyber-sdk-8.5.1.jar" />
  </prebuildCopies>

  <resourceCopies>

  </resourceCopies>


  <buildXmlPropertyAdditions>
    <insert>

    </insert>
  </buildXmlPropertyAdditions>


  <gameActivityPostImportAdditions>
    <insert>

    </insert>
  </gameActivityPostImportAdditions>

  <gameActivityImportAdditions>
    <insert>
import com.fyber.Fyber;
import com.fyber.requesters.RewardedVideoRequester;
import com.fyber.ads.AdFormat;
import com.fyber.requesters.RequestCallback;
import com.fyber.requesters.RequestError;
import com.fyber.utils.FyberLogger;
    </insert>
  </gameActivityImportAdditions>

  <gameActivityOnCreateAdditions>
    <if condition="bDistribution">
      <false>
        <insert>
          FyberLogger.enableLogging(true);    
        </insert>
      </false>
    </if>
  </gameActivityOnCreateAdditions>

  <gameActivityOnStartAdditions>
    <insert>
  
    </insert>
  </gameActivityOnStartAdditions>

  <gameActivityOnStopAdditions>
    <insert>
  
    </insert>
  </gameActivityOnStopAdditions>

  <gameActivityOnPauseAdditions>
    <insert>
    
    </insert>
  </gameActivityOnPauseAdditions>

  <gameActivityOnResumeAdditions>
    <insert>
Log.debug("Fyber SDK initialization...");

try
{
  Fyber.with(sFyberAppId, this).withSecurityToken(sFyberSecurityToken).start();
}
catch(Exception ex)
{
  Log.debug(ex.getMessage());
}     
    </insert>
  </gameActivityOnResumeAdditions>

  <gameActivityOnActivityResultAdditions>
    <insert>

    </insert>
  </gameActivityOnActivityResultAdditions>

<gameActivityClassAdditions>
    <insert><![CDATA[

   public void AndroidThunkJava_FyberInit(String appID, String securityToken)
    {
      Log.debug("Fyber Init!");

        Fyber.with(appID, this)
                .withSecurityToken(securityToken)
                .start();
    }

    public void AndroidThunkJava_FyberRequestVideo(String placementID)
    {
        RequestCallback requestCallback = new RequestCallback() {
            @Override
            public void onAdAvailable(Intent intent) {
                Log.debug("Ad is available");
                startActivityForResult(intent, 0);
            }

            @Override
            public void onAdNotAvailable(AdFormat adFormat) {
              Log.debug("Ad is not available");
            }

            @Override
            public void onRequestError(RequestError requestError) {
                Log.debug("Something went wrong with the request: " + requestError.getDescription());
            }
        };

        RewardedVideoRequester.create(requestCallback).request(this);
    }


]]></insert>
  </gameActivityClassAdditions>
  


  <proguardAdditions>
    <insert>
<![CDATA[
# Fyber

-keep class com.fyber.** { *; }
-dontwarn com.fyber.**
-keep class com.sponsorpay.mediation.** { *;}
-keepattributes JavascriptInterface
-keep class com.sponsorpay.publisher.mbe.mediation.SPBrandEngageMediationJSInterface {
    void setValue(java.lang.String);
}
-keep class android.webkit.JavascriptInterface

-keepattributes SourceFile,LineNumberTable
-keepattributes JavascriptInterface
-keep class com.unity3d.ads.android.**
{ *; }


# google play service
-keep class com.google.android.gms.** { *; }
-dontwarn com.google.android.gms.**

-keep class * extends java.util.ListResourceBundle {
    protected Object[][] getContents();
}

-keep public class com.google.android.gms.common.internal.safeparcel.SafeParcelable {
    public static final *** NULL;
}

-keepnames @com.google.android.gms.common.annotation.KeepName class *
-keepclassmembernames class * {
    @com.google.android.gms.common.annotation.KeepName *;
}

-keepnames class * implements android.os.Parcelable {
    public static final ** CREATOR;
}

#sdkbox
-keep class com.sdkbox.** { *; }
-dontwarn com.sdkbox.**
]]>
    </insert>
  </proguardAdditions>
  
</root>





